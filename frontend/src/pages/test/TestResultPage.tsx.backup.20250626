// file: frontend/src/pages/test/TestResultPage.tsx
import React, { useState, useEffect } from 'react';
import { useParams, useLocation, useNavigate } from 'react-router-dom';
import { ArrowLeftIcon, ShareIcon, DocumentArrowDownIcon, InformationCircleIcon } from '@heroicons/react/24/outline';
import Button from '../../components/common/Button';
import ResultHeader from '../../components/result/ResultHeader';
import SportsmanshipChart from '../../components/result/SportsmanshipChart';
import { SportsmanshipScoreCard, AthleteMinScoreCard, SelfEsteemScoreCard } from '../../components/result/CategoryScoreCard';
import InsightPanel from '../../components/result/InsightPanel';
import { useAuthStore } from '../../store/authStore';
import { User, UserRole } from '../../types/auth';

// æ¨™æº–åŒ–ã•ã‚ŒãŸTestResultå‹å®šç¾©
interface TestResult {
  result_id: string;
  user_id: string;
  test_date: string;
  
  // è‡ªå·±è‚¯å®šæ„Ÿé–¢é€£
  self_determination: number;
  self_acceptance: number;
  self_worth: number;
  self_efficacy: number;
  
  // ã‚¢ã‚¹ãƒªãƒ¼ãƒˆãƒã‚¤ãƒ³ãƒ‰ï¼ˆæ¨™æº–åŒ–ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åï¼‰
  introspection: number;   // å†…çœ
  self_control: number;    // å…‹å·±
  devotion: number;        // çŒ®èº«ï¼ˆæ—§: dedicationï¼‰
  intuition: number;       // ç›´æ„Ÿ
  sensitivity: number;     // ç¹Šç´°
  steadiness: number;      // å …å®Ÿ
  comparison: number;      // æ¯”è¼ƒ
  result: number;          // çµæœï¼ˆæ—§: result_focusï¼‰
  assertion: number;       // ä¸»å¼µ
  commitment: number;      // ã“ã ã‚ã‚Šï¼ˆæ—§: thoroughnessï¼‰
  
  // ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—
  courage: number;
  resilience: number;
  cooperation: number;
  natural_acceptance: number;
  non_rationality: number;
  
  // åˆ†æçµæœ
  self_esteem_total: number;
  self_esteem_analysis: string;
  self_esteem_improvements: string[];
  athlete_type: string;
  athlete_type_description: string;
  athlete_type_percentages: Record<string, number>;
  strengths: string[];
  weaknesses: string[];
  sportsmanship_balance: string;
}

const TestResultPage = () => {
  const { resultId } = useParams();
  const location = useLocation();
  const navigate = useNavigate();
  const { login } = useAuthStore();
  
  const [result, setResult] = useState<TestResult | null>(null);
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  
  // èª¬æ˜è¡¨ç¤ºã®ãƒˆã‚°ãƒ«çŠ¶æ…‹
  const [showSelfEsteemInfo, setShowSelfEsteemInfo] = useState(false);
  const [showSelfAcceptanceInfo, setShowSelfAcceptanceInfo] = useState(false);
  const [showSelfWorthInfo, setShowSelfWorthInfo] = useState(false);
  const [showSelfDeterminationInfo, setShowSelfDeterminationInfo] = useState(false);
  const [showSelfEfficacyInfo, setShowSelfEfficacyInfo] = useState(false);

  // æ–°ã—ãæå‡ºã•ã‚ŒãŸãƒ†ã‚¹ãƒˆçµæœã‚’location.stateã‹ã‚‰å–å¾—
  const newTestResult = location.state?.testResult;
  const isNewResult = location.state?.isNewResult;

  useEffect(() => {
    console.log('TestResultPage: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ç¢ºèªé–‹å§‹');
    const userStr = localStorage.getItem('user');
    if (userStr) {
      try {
        const userData = JSON.parse(userStr);
        setUser(userData);
        console.log('TestResultPage: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—æˆåŠŸ:', userData);
      } catch (err) {
        console.error('TestResultPage: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—:', err);
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        const sampleUser: User = {
          user_id: '123',
          name: 'ç”°ä¸­å¤ªéƒ',
          role: UserRole.PLAYER,
          email: 'tanaka@example.com',
          club_id: 'sample-club',
          parent_function: false,
          head_coach_function: false,
          created_date: new Date().toISOString(),
          updated_date: new Date().toISOString()
        };
        setUser(sampleUser);
        localStorage.setItem('user', JSON.stringify(sampleUser));
        // èªè¨¼çŠ¶æ…‹ã‚’æ›´æ–°
        login({
          user: sampleUser,
          access_token: 'sample-token',
          token_type: 'bearer'
        });
        console.log('TestResultPage: ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯');
      }
    } else {
      console.log('TestResultPage: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãªã—ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½¿ç”¨');
      // ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const sampleUser: User = {
        user_id: '123',
        name: 'ç”°ä¸­å¤ªéƒ',
        role: UserRole.PLAYER,
        email: 'tanaka@example.com',
        club_id: 'sample-club',
        parent_function: false,
        head_coach_function: false,
        created_date: new Date().toISOString(),
        updated_date: new Date().toISOString()
      };
      setUser(sampleUser);
      localStorage.setItem('user', JSON.stringify(sampleUser));
      // èªè¨¼çŠ¶æ…‹ã‚’æ›´æ–°
      login({
        user: sampleUser,
        access_token: 'sample-token',
        token_type: 'bearer'
      });
    }

    // æ–°ã—ã„çµæœãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ç”¨
    if (newTestResult && isNewResult) {
      setResult(newTestResult);
      setLoading(false);
      return;
    }

    // resultIdãŒ"latest"ã®å ´åˆã‚„APIã‹ã‚‰å–å¾—ãŒå¿…è¦ãªå ´åˆ
    const fetchResult = async () => {
      try {
        setLoading(true);
        
        // TODO: å®Ÿéš›ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ãƒ†ã‚¹ãƒˆçµæœã‚’å–å¾—
        // const response = await apiService.get<TestResult>(`/tests/${resultId}`);
        // setResult(response);

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆæ¨™æº–åŒ–ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åä½¿ç”¨ï¼‰
        const sampleResult: TestResult = {
          result_id: resultId || 'sample-id',
          user_id: user?.user_id || 'sample-user',
          test_date: new Date().toISOString(),
          
          // è‡ªå·±è‚¯å®šæ„Ÿé–¢é€£
          self_determination: 37.5,
          self_acceptance: 34,
          self_worth: 36,
          self_efficacy: 40,
          
          // ã‚¢ã‚¹ãƒªãƒ¼ãƒˆãƒã‚¤ãƒ³ãƒ‰ï¼ˆæ¨™æº–åŒ–ã•ã‚ŒãŸåå‰ï¼‰
          introspection: 78,
          self_control: 82,
          devotion: 85,        // æ—§: dedication
          intuition: 70,
          sensitivity: 65,
          steadiness: 88,
          comparison: 75,
          result: 90,          // æ—§: result_focus
          assertion: 77,
          commitment: 83,      // æ—§: thoroughness
          
          // ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—
          courage: 85,
          resilience: 78,
          cooperation: 72,
          natural_acceptance: 68,
          non_rationality: 45,
          
          // åˆ†æçµæœ
          self_esteem_total: 147.5,
          self_esteem_analysis: "ã‚ãªãŸã®è‡ªå·±è‚¯å®šæ„Ÿã¯è‰¯å¥½ãªçŠ¶æ…‹ã§ã™ã€‚ç‰¹ã«è‡ªå·±åŠ¹åŠ›æ„ŸãŒé«˜ãã€ç›®æ¨™é”æˆã¸ã®è‡ªä¿¡ã‚’æŒã£ã¦ã„ã¾ã™ã€‚è‡ªå·±å—å®¹ã®é¢ã§ã•ã‚‰ãªã‚‹å‘ä¸Šã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚",
          self_esteem_improvements: [
            "å®šæœŸçš„ãªè‡ªå·±æŒ¯ã‚Šè¿”ã‚Šã®æ™‚é–“ã‚’è¨­ã‘ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™",
            "å°ã•ãªæˆåŠŸä½“é¨“ã‚’ç©ã¿é‡ã­ã¦ã„ãã¾ã—ã‚‡ã†",
            "ä»–è€…ã¨ã®æ¯”è¼ƒã‚ˆã‚Šè‡ªåˆ†è‡ªèº«ã®æˆé•·ã«ç„¦ç‚¹ã‚’å½“ã¦ã¾ã—ã‚‡ã†",
            "å¤±æ•—ã‚’å­¦ç¿’ã®æ©Ÿä¼šã¨ã—ã¦æ‰ãˆã‚‹ç¿’æ…£ã‚’èº«ã«ã¤ã‘ã¾ã—ã‚‡ã†"
          ],
          athlete_type: "ã‚¢ã‚¿ãƒƒã‚«ãƒ¼",
          athlete_type_description: "æ”»æ’ƒçš„ã§çµæœã‚’è¿½æ±‚ã—ã€çŠ¶æ³ã‚’åˆ‡ã‚Šé–‹ãåŠ›ã‚’æŒã¤ã‚¿ã‚¤ãƒ—ã€‚ç›®æ¨™ã«å‘ã‹ã£ã¦è‡ªã‚‰å‹•ãã€æœ€å‰ç·šã§æˆ¦ã†å§¿å‹¢ãŒç‰¹å¾´ã§ã™ã€‚",
          athlete_type_percentages: {
            "ã‚¹ãƒˆãƒ©ã‚¤ã‚«ãƒ¼": 65,
            "ã‚¢ã‚¿ãƒƒã‚«ãƒ¼": 78,
            "ã‚²ãƒ¼ãƒ ãƒ¡ã‚¤ã‚«ãƒ¼": 45,
            "ã‚¢ãƒ³ã‚«ãƒ¼": 52,
            "ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ãƒ€ãƒ¼": 38
          },
          strengths: ["çµæœå¿—å‘", "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", "ç›®æ¨™è¨­å®š", "ç«¶äº‰å¿ƒ", "å®Ÿè¡ŒåŠ›"],
          weaknesses: ["å®Œç’§ä¸»ç¾©", "ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼æ„Ÿå—æ€§", "å”èª¿æ€§", "æŸ”è»Ÿæ€§", "æ„Ÿæƒ…åˆ¶å¾¡"],
          sportsmanship_balance: "å…¨ä½“çš„ã«ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã¾ã™ãŒã€éåˆç†æ€§ã®åˆ†é‡ã§æˆé•·ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚è«–ç†çš„æ€è€ƒãŒå¼·ã„ä¸€æ–¹ã§ã€ç›´æ„Ÿã‚„æ„Ÿæƒ…çš„ãªåˆ¤æ–­ã‚‚é‡è¦ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚"
        };

        setTimeout(() => {
          setResult(sampleResult);
          setLoading(false);
        }, 1000); // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°åŠ¹æœã®ãŸã‚ã®é…å»¶

      } catch (err: any) {
        console.error('ãƒ†ã‚¹ãƒˆçµæœã®å–å¾—ã«å¤±æ•—:', err);
        setError('ãƒ†ã‚¹ãƒˆçµæœã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        setLoading(false);
      }
    };

    fetchResult();
  }, [resultId, newTestResult, isNewResult, navigate]);

  const handleShare = () => {
    if (navigator.share) {
      navigator.share({
        title: 'ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—ãƒ†ã‚¹ãƒˆçµæœ',
        text: `ç§ã®ã‚¢ã‚¹ãƒªãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ã¯ã€Œ${result?.athlete_type}ã€ã§ã—ãŸï¼`,
        url: window.location.href,
      });
    } else {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: URLã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
      navigator.clipboard.writeText(window.location.href);
      alert('çµæœã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
    }
  };

  const handleExportPDF = () => {
    // TODO: PDFå‡ºåŠ›æ©Ÿèƒ½ã®å®Ÿè£…
    alert('PDFå‡ºåŠ›æ©Ÿèƒ½ã¯è¿‘æ—¥å®Ÿè£…äºˆå®šã§ã™');
  };

  const handleBackToDashboard = () => {
    navigate('/dashboard');
  };

  // è‡ªå·±è‚¯å®šæ„Ÿã®åˆè¨ˆã‚’è¨ˆç®—ï¼ˆè‡ªå·±åŠ¹åŠ›æ„Ÿã¯åˆ¥é€”è¡¨ç¤ºï¼‰
  const selfEsteemTotal = result ? (result.self_acceptance + result.self_worth + result.self_determination) : 0;

  // è‡ªå·±è‚¯å®šæ„Ÿã®åˆ†ææ–‡ã‚’ç”Ÿæˆ
  const generateSelfEsteemAnalysis = () => {
    if (!result) return '';
    
    const acceptance = result.self_acceptance;
    const worth = result.self_worth;
    const determination = result.self_determination;
    const efficacy = result.self_efficacy;
    
    let analysis = `ã‚ãªãŸã®è‡ªå·±è‚¯å®šæ„Ÿã¯${selfEsteemTotal}/150ç‚¹ã§ã™ã€‚`;
    
    if (acceptance >= 40) {
      analysis += `è‡ªå·±å—å®¹æ„ŸãŒé«˜ãã€è‡ªåˆ†è‡ªèº«ã‚’ã‚ã‚Šã®ã¾ã¾å—ã‘å…¥ã‚Œã‚‹åŠ›ãŒå‚™ã‚ã£ã¦ã„ã¾ã™ã€‚`;
    } else if (acceptance >= 30) {
      analysis += `è‡ªå·±å—å®¹æ„Ÿã¯å¹³å‡çš„ã§ã€æ™‚ã«è‡ªåˆ†ã‚’å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã«è‘›è—¤ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚`;
    } else {
      analysis += `è‡ªå·±å—å®¹æ„Ÿã«èª²é¡ŒãŒã‚ã‚Šã€è‡ªåˆ†ã‚’å¦å®šçš„ã«æ‰ãˆãŒã¡ãªå‚¾å‘ãŒã‚ã‚Šã¾ã™ã€‚`;
    }
    
    if (worth >= 40) {
      analysis += `ã¾ãŸã€è‡ªå·±æœ‰ç”¨æ„Ÿã‚‚é«˜ãã€è‡ªåˆ†ã®å­˜åœ¨ä¾¡å€¤ã‚’å¼·ãæ„Ÿã˜ã¦ã„ã¾ã™ã€‚`;
    } else if (worth >= 30) {
      analysis += `è‡ªå·±æœ‰ç”¨æ„Ÿã¯æ¨™æº–çš„ã§ã€çŠ¶æ³ã«ã‚ˆã‚Šè‡ªä¿¡ãŒæºã‚‰ãã“ã¨ã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚`;
    } else {
      analysis += `è‡ªå·±æœ‰ç”¨æ„Ÿã‚’é«˜ã‚ã‚‹ä½™åœ°ãŒã‚ã‚Šã€è‡ªåˆ†ã®ä¾¡å€¤ã‚’è¦‹å‡ºã™ã“ã¨ã«è‹¦åŠ´ã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚`;
    }
    
    if (determination >= 40) {
      analysis += `è‡ªå·±æ±ºå®šæ„Ÿã‚‚å„ªã‚Œã¦ãŠã‚Šã€ä¸»ä½“çš„ã«ç‰©äº‹ã‚’æ±ºå®šã—è¡Œå‹•ã§ãã¦ã„ã¾ã™ã€‚`;
    } else if (determination >= 30) {
      analysis += `è‡ªå·±æ±ºå®šæ„Ÿã¯é©åº¦ã§ã€æ™‚ã«ä»–è€…ã®æ„è¦‹ã«æµã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚`;
    } else {
      analysis += `è‡ªå·±æ±ºå®šæ„Ÿã‚’è‚²ã¦ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šä¸»ä½“çš„ãªè¡Œå‹•ãŒå–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚`;
    }
    
    // ã‚¢ã‚¹ãƒªãƒ¼ãƒˆãƒã‚¤ãƒ³ãƒ‰ã®è¦ç´ ã‚‚åæ˜ 
    if (result.introspection >= 80) {
      analysis += `å†…çœåŠ›ãŒé«˜ã„ã“ã¨ã‚‚ã€è‡ªå·±ç†è§£ã‚’æ·±ã‚ã‚‹å¼·ã¿ã¨ãªã£ã¦ã„ã¾ã™ã€‚`;
    }
    
    if (result.self_control >= 80) {
      analysis += `å„ªã‚ŒãŸå…‹å·±å¿ƒã¯ã€ç›®æ¨™ã«å‘ã‹ã£ã¦åŠªåŠ›ã‚’ç¶™ç¶šã™ã‚‹åŸå‹•åŠ›ã«ãªã£ã¦ã„ã¾ã™ã€‚`;
    }
    
    return analysis;
  };

  // è‡ªå·±è‚¯å®šæ„Ÿæ”¹å–„ã®ãŸã‚ã®æ„è­˜ã™ã¹ãã“ã¨
  const generateSelfEsteemImprovements = () => {
    if (!result) return [];
    
    const improvements = [];
    
    if (result.self_acceptance < 35) {
      improvements.push('æ¯æ—¥ã€è‡ªåˆ†ã®è‰¯ã‹ã£ãŸç‚¹ã‚’3ã¤æ›¸ãå‡ºã™ç¿’æ…£ã‚’ã¤ã‘ã‚‹');
      improvements.push('å¤±æ•—ã‚’æˆé•·ã®æ©Ÿä¼šã¨ã—ã¦å‰å‘ãã«æ‰ãˆã‚‹ç·´ç¿’ã‚’ã™ã‚‹');
    }
    
    if (result.self_worth < 35) {
      improvements.push('å°ã•ãªæˆåŠŸä½“é¨“ã‚’æ„è­˜çš„ã«ç©ã¿é‡ã­ã€è¨˜éŒ²ã™ã‚‹');
      improvements.push('ä»–è€…ã¸ã®è²¢çŒ®ã‚’é€šã˜ã¦è‡ªåˆ†ã®ä¾¡å€¤ã‚’å®Ÿæ„Ÿã™ã‚‹æ©Ÿä¼šã‚’å¢—ã‚„ã™');
    }
    
    if (result.self_determination < 35) {
      improvements.push('æ—¥ã€…ã®å°ã•ãªé¸æŠã‹ã‚‰è‡ªåˆ†ã§æ±ºã‚ã‚‹ç¿’æ…£ã‚’èº«ã«ã¤ã‘ã‚‹');
      improvements.push('è‡ªåˆ†ã®æ„è¦‹ã‚’è¨€è‘‰ã«ã—ã¦è¡¨ç¾ã™ã‚‹ç·´ç¿’ã‚’ã™ã‚‹');
    }
    
    if (improvements.length < 5) {
      improvements.push('å®šæœŸçš„ã«è‡ªå·±æŒ¯ã‚Šè¿”ã‚Šã®æ™‚é–“ã‚’è¨­ã‘ã€æˆé•·ã‚’ç¢ºèªã™ã‚‹');
      improvements.push('ä»–è€…ã¨æ¯”è¼ƒã›ãšã€éå»ã®è‡ªåˆ†ã¨æ¯”è¼ƒã—ã¦æˆé•·ã‚’å®Ÿæ„Ÿã™ã‚‹');
      improvements.push('æ„Ÿè¬ã®æ°—æŒã¡ã‚’æ—¥è¨˜ã«æ›¸ãã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè¦–ç‚¹ã‚’é¤Šã†');
    }
    
    return improvements.slice(0, 5);
  };

  // è‡ªå·±åŠ¹åŠ›æ„Ÿã®åˆ†ææ–‡ã‚’ç”Ÿæˆ
  const generateSelfEfficacyAnalysis = () => {
    if (!result) return '';
    
    const efficacy = result.self_efficacy;
    let analysis = `ã‚ãªãŸã®è‡ªå·±åŠ¹åŠ›æ„Ÿã¯${efficacy}/50ç‚¹ã§ã™ã€‚`;
    
    if (efficacy >= 40) {
      analysis += `ç›®æ¨™é”æˆã¸ã®è‡ªä¿¡ãŒéå¸¸ã«é«˜ãã€å›°é›£ãªèª²é¡Œã«ã‚‚ç©æ¥µçš„ã«å–ã‚Šçµ„ã‚ã‚‹çŠ¶æ…‹ã§ã™ã€‚`;
    } else if (efficacy >= 30) {
      analysis += `é©åº¦ãªè‡ªä¿¡ã‚’æŒã£ã¦ãŠã‚Šã€å¤šãã®èª²é¡Œã«å¯¾ã—ã¦å‰å‘ãã«å–ã‚Šçµ„ã‚ã¦ã„ã¾ã™ã€‚`;
    } else {
      analysis += `è‡ªå·±åŠ¹åŠ›æ„Ÿã‚’é«˜ã‚ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå¤§ããªç›®æ¨™ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚`;
    }
    
    // ä»–ã®è¦ç´ ã¨ã®é–¢é€£
    if (result.result >= 80) {
      analysis += `çµæœå¿—å‘ã®å¼·ã•ãŒã€ç›®æ¨™é”æˆã¸ã®æ¨é€²åŠ›ã¨ãªã£ã¦ã„ã¾ã™ã€‚`;
    }
    
    if (result.commitment >= 80) {
      analysis += `å¼·ã„ã“ã ã‚ã‚Šã¯ã€è³ªã®é«˜ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç”Ÿã¿å‡ºã™æºæ³‰ã§ã™ã€‚`;
    }
    
    if (result.resilience >= 75) {
      analysis += `ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ã®é«˜ã•ã¯ã€æŒ«æŠ˜ã‚’ä¹—ã‚Šè¶Šãˆã‚‹åŠ›ã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚`;
    }
    
    // æ”¹å–„ç‚¹ã®ç¤ºå”†
    if (efficacy < 35) {
      analysis += `æ®µéšçš„ãªç›®æ¨™è¨­å®šã«ã‚ˆã‚Šã€æˆåŠŸä½“é¨“ã‚’ç©ã¿é‡ã­ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚éå»ã®æˆåŠŸä½“é¨“ã‚’æŒ¯ã‚Šè¿”ã‚Šã€è‡ªä¿¡ã®æºã‚’å†ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚`;
    } else {
      analysis += `ç¾åœ¨ã®è‡ªä¿¡ã‚’ç¶­æŒã—ãªãŒã‚‰ã€æ–°ãŸãªæŒ‘æˆ¦ã‚’é€šã˜ã¦ã•ã‚‰ãªã‚‹æˆé•·ã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚`;
    }
    
    return analysis;
  };

  // è‡ªå·±åŠ¹åŠ›æ„Ÿæ”¹å–„ã®ãŸã‚ã®æ„è­˜ã™ã¹ãã“ã¨
  const generateSelfEfficacyImprovements = () => {
    if (!result) return [];
    
    const improvements = [];
    const efficacy = result.self_efficacy;
    
    if (efficacy < 40) {
      improvements.push('é”æˆå¯èƒ½ãªå°ã•ãªç›®æ¨™ã‚’è¨­å®šã—ã€æˆåŠŸä½“é¨“ã‚’ç©ã¿é‡ã­ã‚‹');
      improvements.push('æˆåŠŸã—ãŸä»–è€…ã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã‚’é€šã˜ã¦ã€è‡ªåˆ†ã«ã‚‚ã§ãã‚‹ã¨ä¿¡ã˜ã‚‹');
      improvements.push('ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè‡ªå·±å¯¾è©±ã‚’å¿ƒãŒã‘ã€ãƒã‚¬ãƒ†ã‚£ãƒ–ãªæ€è€ƒã‚’å¤‰æ›ã™ã‚‹');
    }
    
    improvements.push('ç›®æ¨™ã‚’å…·ä½“çš„ã«å¯è¦–åŒ–ã—ã€é”æˆã¾ã§ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ˜ç¢ºã«ã™ã‚‹');
    improvements.push('å¤±æ•—ã‚’å­¦ç¿’æ©Ÿä¼šã¨æ‰ãˆã€æ¬¡ã¸ã®æ”¹å–„ç‚¹ã‚’å…·ä½“çš„ã«è¦‹ã¤ã‘ã‚‹');
    improvements.push('è‡ªåˆ†ã®å¼·ã¿ã‚’æ´»ã‹ã›ã‚‹å ´é¢ã‚’æ„è­˜çš„ã«å¢—ã‚„ã™');
    improvements.push('ãƒ¡ãƒ³ã‚¿ãƒ¼ã‚„ã‚³ãƒ¼ãƒã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç©æ¥µçš„ã«æ±‚ã‚ã‚‹');
    improvements.push('æ—¥ã€…ã®å°ã•ãªé€²æ­©ã‚’è¨˜éŒ²ã—ã€æˆé•·ã‚’å®Ÿæ„Ÿã™ã‚‹ç¿’æ…£ã‚’ã¤ã‘ã‚‹');
    
    return improvements.slice(0, 5);
  };

  // ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—ç·åˆåˆ†æ
  const generateSportsmanshipAnalysis = () => {
    if (!result) return '';
    
    const selfEsteemScore = selfEsteemTotal;
    const efficacyScore = result.self_efficacy;
    
    let analysis = `ã‚ãªãŸã®ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—ã¯ã€è‡ªå·±è‚¯å®šæ„Ÿï¼ˆ${selfEsteemScore}/150ï¼‰ã¨è‡ªå·±åŠ¹åŠ›æ„Ÿï¼ˆ${efficacyScore}/50ï¼‰ã®ãƒãƒ©ãƒ³ã‚¹ã‹ã‚‰è¦‹ã‚‹ã¨ã€`;
    
    if (selfEsteemScore >= 120 && efficacyScore >= 40) {
      analysis += `éå¸¸ã«å„ªã‚ŒãŸçŠ¶æ…‹ã«ã‚ã‚Šã¾ã™ã€‚è‡ªåˆ†ã‚’è‚¯å®šçš„ã«æ‰ãˆã€ç›®æ¨™é”æˆã¸ã®ç¢ºä¿¡ã‚‚å¼·ãã€ç†æƒ³çš„ãªãƒ¡ãƒ³ã‚¿ãƒ«çŠ¶æ…‹ã§ã™ã€‚`;
    } else if (selfEsteemScore >= 90 && efficacyScore >= 30) {
      analysis += `è‰¯å¥½ãªçŠ¶æ…‹ã§ã™ã€‚åŸºæœ¬çš„ãªè‡ªå·±è‚¯å®šæ„Ÿã¨å®Ÿè¡ŒåŠ›ã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã¾ã™ã€‚`;
    } else {
      analysis += `æˆé•·ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚è‡ªå·±ç†è§£ã‚’æ·±ã‚ã€æ®µéšçš„ãªæˆåŠŸä½“é¨“ã‚’é‡ã­ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚`;
    }
    
    // ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—ã®5è¦ç´ ã¨ã®é–¢é€£
    if (result.courage >= 80 && result.resilience >= 80) {
      analysis += `å‹‡æ°—ã¨ãƒ¬ã‚¸ãƒªã‚¨ãƒ³ã‚¹ã®é«˜ã•ã¯ã€å›°é›£ãªçŠ¶æ³ã§ã‚‚å‰é€²ã™ã‚‹åŠ›ã¨ãªã£ã¦ã„ã¾ã™ã€‚`;
    }
    
    if (result.cooperation >= 75) {
      analysis += `å”èª¿æ€§ã®é«˜ã•ã¯ã€ãƒãƒ¼ãƒ å†…ã§ã®ä¿¡é ¼é–¢ä¿‚æ§‹ç¯‰ã«è²¢çŒ®ã—ã¦ã„ã¾ã™ã€‚`;
    }
    
    // ãƒãƒ©ãƒ³ã‚¹ã®è¦³ç‚¹
    const gap = Math.abs((selfEsteemScore / 3) - efficacyScore);
    if (gap > 15) {
      analysis += `è‡ªå·±è‚¯å®šæ„Ÿã¨è‡ªå·±åŠ¹åŠ›æ„Ÿã®ãƒãƒ©ãƒ³ã‚¹ã«å·®ãŒã‚ã‚Šã¾ã™ã€‚ä¸¡è€…ã‚’èª¿å’Œã•ã›ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå®‰å®šã—ãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæœŸå¾…ã§ãã¾ã™ã€‚`;
    } else {
      analysis += `ä¸¡è€…ã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ãã€å®‰å®šã—ãŸãƒ¡ãƒ³ã‚¿ãƒ«åŸºç›¤ãŒå½¢æˆã•ã‚Œã¦ã„ã¾ã™ã€‚`;
    }
    
    analysis += `ä»Šå¾Œã¯ã€å¼±ã„éƒ¨åˆ†ã‚’è£œå¼·ã—ãªãŒã‚‰ã€å¼·ã¿ã‚’ã•ã‚‰ã«ä¼¸ã°ã™ã“ã¨ã§ã€çœŸã®ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—ã‚’ä½“ç¾ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚`;
    
    return analysis;
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-4 border-indigo-500 border-t-transparent mx-auto mb-4"></div>
          <p className="text-lg text-gray-600">çµæœã‚’åˆ†æä¸­...</p>
          <p className="text-sm text-gray-500 mt-2">ç´ æ™´ã‚‰ã—ã„çµæœã‚’ãŠå¾…ã¡ãã ã•ã„</p>
        </div>
      </div>
    );
  }

  if (error || !result || !user) {
    return (
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="text-center">
          <div className="text-red-600 text-lg mb-4">{error || 'ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'}</div>
          <Button onClick={handleBackToDashboard}>
            ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
          </Button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Navigation */}
        <div className="mb-8">
          <Button
            variant="secondary"
            onClick={handleBackToDashboard}
            className="inline-flex items-center"
          >
            <ArrowLeftIcon className="w-4 h-4 mr-2" />
            ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
          </Button>
        </div>

        <div className="space-y-8">
          {/* Result Header */}
          <ResultHeader
            userName={user.name}
            userRole={user.role}
            testDate={result.test_date}
            athleteType={result.athlete_type}
            onExportPDF={handleExportPDF}
            onShare={handleShare}
          />

          {/* New Result Celebration */}
          {isNewResult && (
            <div className="bg-gradient-to-r from-green-100 to-emerald-100 border border-green-200 rounded-2xl p-6 text-center shadow-lg">
              <div className="text-green-800">
                <h3 className="text-xl font-bold mb-2">ğŸ‰ ãƒ†ã‚¹ãƒˆå®Œäº†ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</h3>
                <p className="text-green-700">
                  ã‚ãªãŸã®çµæœã‚’è©³ã—ãåˆ†æã—ã¾ã—ãŸã€‚ä¸‹è¨˜ã®å†…å®¹ã‚’ã˜ã£ãã‚Šã¨ã”ç¢ºèªãã ã•ã„ã€‚
                </p>
              </div>
            </div>
          )}

          {/* è‡ªå·±è‚¯å®šæ„Ÿãƒ»è‡ªå·±åŠ¹åŠ›æ„Ÿã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
          <div className="bg-white rounded-2xl shadow-lg p-8 space-y-8">
            {/* è‡ªå·±è‚¯å®šæ„Ÿ */}
            <div>
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-2xl font-bold text-gray-800">è‡ªå·±è‚¯å®šæ„Ÿ</h3>
                <div className="text-3xl font-bold text-indigo-600">{selfEsteemTotal}/150</div>
              </div>
              
              <button
                onClick={() => setShowSelfEsteemInfo(!showSelfEsteemInfo)}
                className="flex items-center text-sm text-indigo-600 hover:text-indigo-800 mb-4"
              >
                <InformationCircleIcon className="w-5 h-5 mr-1" />
                è‡ªå·±è‚¯å®šæ„Ÿã¨ã¯ï¼Ÿ
              </button>
              
              {showSelfEsteemInfo && (
                <div className="bg-indigo-50 rounded-lg p-4 mb-4 text-sm text-gray-700">
                  è‡ªå·±è‚¯å®šæ„Ÿã¨ã¯ã€è‡ªåˆ†è‡ªèº«ã‚’ä¾¡å€¤ã‚ã‚‹å­˜åœ¨ã¨ã—ã¦è‚¯å®šçš„ã«æ‰ãˆã‚‹æ„Ÿè¦šã§ã™ã€‚
                  è‡ªå·±å—å®¹æ„Ÿã€è‡ªå·±æœ‰ç”¨æ„Ÿã€è‡ªå·±æ±ºå®šæ„Ÿã®3ã¤ã®è¦ç´ ã‹ã‚‰æ§‹æˆã•ã‚Œã¾ã™ã€‚
                </div>
              )}
              
              {/* 3ã¤ã®è¦ç´  */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div className="bg-gray-50 rounded-lg p-4">
                  <div className="flex items-center justify-between mb-2">
                    <span className="font-medium text-gray-700">è‡ªå·±å—å®¹æ„Ÿ</span>
                    <span className="text-xl font-bold text-gray-800">{result.self_acceptance}/50</span>
                  </div>
                  <button
                    onClick={() => setShowSelfAcceptanceInfo(!showSelfAcceptanceInfo)}
                    className="text-xs text-indigo-600 hover:text-indigo-800"
                  >
                    è©³ç´°ã‚’è¦‹ã‚‹
                  </button>
                  {showSelfAcceptanceInfo && (
                    <div className="mt-2 text-xs text-gray-600">
                      ã‚ã‚Šã®ã¾ã¾ã®è‡ªåˆ†ã‚’å—ã‘å…¥ã‚Œã‚‹åŠ›ã€‚å¤±æ•—ã‚„æ¬ ç‚¹ã‚‚å«ã‚ã¦è‡ªåˆ†ã‚’èªã‚ã‚‰ã‚Œã‚‹æ„Ÿè¦šã§ã™ã€‚
                    </div>
                  )}
                </div>
                
                <div className="bg-gray-50 rounded-lg p-4">
                  <div className="flex items-center justify-between mb-2">
                    <span className="font-medium text-gray-700">è‡ªå·±æœ‰ç”¨æ„Ÿ</span>
                    <span className="text-xl font-bold text-gray-800">{result.self_worth}/50</span>
                  </div>
                  <button
                    onClick={() => setShowSelfWorthInfo(!showSelfWorthInfo)}
                    className="text-xs text-indigo-600 hover:text-indigo-800"
                  >
                    è©³ç´°ã‚’è¦‹ã‚‹
                  </button>
                  {showSelfWorthInfo && (
                    <div className="mt-2 text-xs text-gray-600">
                      è‡ªåˆ†ãŒèª°ã‹ã®å½¹ã«ç«‹ã£ã¦ã„ã‚‹ã€å¿…è¦ã¨ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†æ„Ÿè¦šã€‚ç¤¾ä¼šçš„ãªå­˜åœ¨ä¾¡å€¤ã‚’æ„Ÿã˜ã‚‹åŠ›ã§ã™ã€‚
                    </div>
                  )}
                </div>
                
                <div className="bg-gray-50 rounded-lg p-4">
                  <div className="flex items-center justify-between mb-2">
                    <span className="font-medium text-gray-700">è‡ªå·±æ±ºå®šæ„Ÿ</span>
                    <span className="text-xl font-bold text-gray-800">{result.self_determination}/50</span>
                  </div>
                  <button
                    onClick={() => setShowSelfDeterminationInfo(!showSelfDeterminationInfo)}
                    className="text-xs text-indigo-600 hover:text-indigo-800"
                  >
                    è©³ç´°ã‚’è¦‹ã‚‹
                  </button>
                  {showSelfDeterminationInfo && (
                    <div className="mt-2 text-xs text-gray-600">
                      è‡ªåˆ†ã®æ„å¿—ã§ç‰©äº‹ã‚’æ±ºå®šã—ã€è¡Œå‹•ã§ãã‚‹ã¨ã„ã†æ„Ÿè¦šã€‚ä¸»ä½“æ€§ã‚„è‡ªå¾‹æ€§ã‚’æŒã¤åŠ›ã§ã™ã€‚
                    </div>
                  )}
                </div>
              </div>
              
              {/* ã‚ãªãŸã®è‡ªå·±è‚¯å®šæ„Ÿã®èª¬æ˜ */}
              <div className="bg-blue-50 rounded-lg p-6">
                <h4 className="font-bold text-gray-800 mb-3">ã‚ãªãŸã®è‡ªå·±è‚¯å®šæ„Ÿã®åˆ†æ</h4>
                <p className="text-gray-700 mb-4">{generateSelfEsteemAnalysis()}</p>
                
                <h5 className="font-semibold text-gray-800 mb-2">æ—¥é ƒæ„è­˜ã™ã¹ãã“ã¨ï¼š</h5>
                <ul className="list-disc list-inside space-y-1 text-gray-700">
                  {generateSelfEsteemImprovements().map((improvement, index) => (
                    <li key={index}>{improvement}</li>
                  ))}
                </ul>
              </div>
            </div>
            
            {/* è‡ªå·±åŠ¹åŠ›æ„Ÿ */}
            <div>
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-2xl font-bold text-gray-800">è‡ªå·±åŠ¹åŠ›æ„Ÿ</h3>
                <div className="text-3xl font-bold text-green-600">{result.self_efficacy}/50</div>
              </div>
              
              <button
                onClick={() => setShowSelfEfficacyInfo(!showSelfEfficacyInfo)}
                className="flex items-center text-sm text-green-600 hover:text-green-800 mb-4"
              >
                <InformationCircleIcon className="w-5 h-5 mr-1" />
                è‡ªå·±åŠ¹åŠ›æ„Ÿã¨ã¯ï¼Ÿ
              </button>
              
              {showSelfEfficacyInfo && (
                <div className="bg-green-50 rounded-lg p-4 mb-4 text-sm text-gray-700">
                  è‡ªå·±åŠ¹åŠ›æ„Ÿã¨ã¯ã€ç›®æ¨™ã‚’é”æˆã™ã‚‹ãŸã‚ã«å¿…è¦ãªè¡Œå‹•ã‚’è‡ªåˆ†ã¯å®Ÿè¡Œã§ãã‚‹ã¨ã„ã†ä¿¡å¿µã‚„è‡ªä¿¡ã®ã“ã¨ã§ã™ã€‚
                  èª²é¡Œã«å¯¾ã—ã¦ã€Œè‡ªåˆ†ãªã‚‰ã§ãã‚‹ã€ã¨æ€ãˆã‚‹æ„Ÿè¦šã§ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®é‡è¦ãªè¦ç´ ã§ã™ã€‚
                </div>
              )}
              
              {/* ã‚ãªãŸã®è‡ªå·±åŠ¹åŠ›æ„Ÿã®èª¬æ˜ */}
              <div className="bg-green-50 rounded-lg p-6">
                <h4 className="font-bold text-gray-800 mb-3">ã‚ãªãŸã®è‡ªå·±åŠ¹åŠ›æ„Ÿã®åˆ†æ</h4>
                <p className="text-gray-700 mb-4">{generateSelfEfficacyAnalysis()}</p>
                
                <h5 className="font-semibold text-gray-800 mb-2">æ—¥é ƒæ„è­˜ã™ã¹ãã“ã¨ï¼š</h5>
                <ul className="list-disc list-inside space-y-1 text-gray-700">
                  {generateSelfEfficacyImprovements().map((improvement, index) => (
                    <li key={index}>{improvement}</li>
                  ))}
                </ul>
              </div>
            </div>
            
            {/* ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—ç·åˆåˆ†æ */}
            <div className="bg-gradient-to-r from-indigo-50 to-green-50 rounded-lg p-6">
              <h4 className="font-bold text-gray-800 mb-3">ã‚¹ãƒãƒ¼ãƒ„ãƒãƒ³ã‚·ãƒƒãƒ—ç·åˆåˆ†æ</h4>
              <p className="text-gray-700">{generateSportsmanshipAnalysis()}</p>
            </div>
          </div>

          {/* Charts Section */}
          <div className="grid grid-cols-1 xl:grid-cols-2 gap-8">
            {/* Sportsmanship Radar Chart */}
            <div className="xl:col-span-2">
              <SportsmanshipChart
                scores={{
                  courage: result.courage,
                  resilience: result.resilience,
                  cooperation: result.cooperation,
                  natural_acceptance: result.natural_acceptance,
                  non_rationality: result.non_rationality
                }}
                maxScore={100}
              />
            </div>
          </div>

          {/* Score Cards */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <SportsmanshipScoreCard scores={{
              courage: result.courage,
              resilience: result.resilience,
              cooperation: result.cooperation,
              natural_acceptance: result.natural_acceptance,
              non_rationality: result.non_rationality
            }} />
            
            {/* ã‚¢ã‚¹ãƒªãƒ¼ãƒˆãƒã‚¤ãƒ³ãƒ‰ã®å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¸¡ã™ */}
            <AthleteMinScoreCard scores={{
              commitment: result.commitment,        // ã“ã ã‚ã‚Š
              result: result.result,               // çµæœ
              steadiness: result.steadiness,       // å …å®Ÿ
              devotion: result.devotion,           // çŒ®èº«
              self_control: result.self_control,   // å…‹å·±
              assertion: result.assertion,         // ä¸»å¼µ
              sensitivity: result.sensitivity,     // ç¹Šç´°
              intuition: result.intuition,         // ç›´æ„Ÿ
              introspection: result.introspection, // å†…çœ
              comparison: result.comparison        // æ¯”è¼ƒ
            }} />
            
            {/* è‡ªå·±è‚¯å®šæ„Ÿã®å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ¸¡ã™ */}
            <SelfEsteemScoreCard scores={{
              self_efficacy: result.self_efficacy,
              self_determination: result.self_determination,
              self_acceptance: result.self_acceptance,
              self_worth: result.self_worth
            }} />
          </div>

          {/* Insight Panel */}
          <InsightPanel
            athleteType={result.athlete_type}
            athleteTypeDescription={result.athlete_type_description}
            athleteTypePercentages={result.athlete_type_percentages}
            strengths={result.strengths}
            weaknesses={result.weaknesses}
            selfEsteemAnalysis={result.self_esteem_analysis}
            selfEsteemImprovements={result.self_esteem_improvements}
            sportsmanshipBalance={result.sportsmanship_balance}
          />

          {/* Action Buttons */}
          <div className="flex flex-col sm:flex-row gap-4 justify-center pt-8">
            <Button
              onClick={handleExportPDF}
              variant="secondary"
              className="inline-flex items-center"
            >
              <DocumentArrowDownIcon className="w-5 h-5 mr-2" />
              PDFã§ä¿å­˜
            </Button>
            
            <Button
              onClick={handleShare}
              className="inline-flex items-center"
            >
              <ShareIcon className="w-5 h-5 mr-2" />
              çµæœã‚’ã‚·ã‚§ã‚¢
            </Button>
            
            <Button
              onClick={() => navigate('/test')}
              variant="secondary"
            >
              å†ãƒ†ã‚¹ãƒˆã‚’å—ã‘ã‚‹
            </Button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default TestResultPage;